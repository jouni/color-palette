<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Lumo color palette generator and contrast checker</title>
  <link rel="stylesheet" href="current-lumo.css">
  <style>
    html {
      background-color: var(--base-color);
      color: var(--body-text-color);
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    * {
      --heading-text-color: var(--gray-900);
      --body-text-color: var(--gray-800);
      --secondary-text-color: var(--gray-600);
      --tertiary-text-color: var(--gray-500);
      --disabled-text-color: var(--gray-400);
      --link-text-color: var(--blue-600);
    }

    body {
      margin: 0;
    }

    .row {
      display: flex;
    }

    .palettes {
      flex: auto;
    }

    .palette,
    .labels {
      display: flex;
      padding: 1rem;
      padding-bottom: 0;
    }

    .labels > div {
      flex: auto;
      font-size: 0.75rem;
      opacity: 0.7;
      flex-basis: 0;
      min-width: 0;
    }

    .palette .swatch {
      flex: auto;
      flex-basis: 0;
      min-width: 0;
      position: relative;
      z-index: 1;
    }

    .palette .swatch .color {
      display: block;
      height: 2rem;
    }

    .palette .swatch .contrast {
      display: flex;
      min-width: 0;
      align-items: center;
      font-size: 0.7em;
    }

    .palette .swatch .contrast::after {
      content: "";
      flex: none;
      width: 0.6em;
      height: 0.6em;
      border-radius: 50%;
      margin: 0 0.2em;
    }

    .palette .swatch .contrast.white::after {
      background: white;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.2);
    }

    .palette .swatch .contrast.black::after {
      background: black;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.2);
    }

    .palette .swatch .contrast[level]::be {
      content: attr(level);
      text-transform: uppercase;
      background-color: green;
      color: white;
      display: inline-block;
      padding: 0.1em 0.2em;
      border-radius: 0.2em;
      font-size: 0.65em;
      font-weight: 500;
      margin-inline-start: 0.2em;
    }

    .palette .swatch:not(:hover) .contrast[level]::be {
      opacity: 0;
    }

    .palette .swatch:not(:hover) .contrast:not([level]) {
      opacity: 0.25;
    }

    .palette .swatch .contrast[level="aaa"] {
      font-weight: 500;
    }

    .palette:hover {
      background-clip: content-box;
      background-size: 20px 10px;
      background-repeat: repeat-x;
      background-origin: content-box;
      background-image: linear-gradient(
        to right,
        rgba(255,255,255,.2),
        rgba(255,255,255,.2) 50%,
        rgba(0,0,0,.2) 50%,
        rgba(0,0,0,.2)
      );
    }

    .light,
    .dark {
      background: var(--base-color);
      color: var(--body-text-color);
    }

    .light {
      --surface-1: var(--base-color) linear-gradient(hsla(210, 0%, 100%, 0.6), hsla(210, 0%, 100%, 0.6));
      --surface-2: var(--base-color) linear-gradient(hsla(210, 0%, 100%, 1), hsla(210, 0%, 100%, 1));
    }

    .dark {
      --surface-1: var(--base-color) linear-gradient(var(--gray-50), var(--gray-50));
      --surface-2: var(--base-color) linear-gradient(var(--gray-100), var(--gray-100));
    }

    .surface {
      display: inline-block;
      width: 50px;
      height: 50px;
      background: var(--surface-1);
    }

    .surface.two {
      background: var(--surface-2);
    }

    .palettes .current {
      background-color: var(--lumo-base-color);
    }

    .testing {
      padding: 2rem;
    }

    .button {
      color: var(--link-text-color);
      background-color: var(--gray-50);
      padding: 0.5em 1em;
      display: inline-flex;
      align-items: center;
      margin: 1em 0.25em;
      border-radius: 0.25em;
      line-height: 1;
      font-weight: 500;
    }

    .button.primary {
      color: white;
      background-color: var(--blue-500);
    }

    .link {
      color: var(--link-text-color);
    }

    .text-input {
      height: 2.25rem;
      display: inline-flex;
      align-items: center;
      padding: 0.25em 0.5em;
      box-sizing: border-box;
      background-color: var(--gray-100);
      color: var(--body-text-color);
      font-weight: 500;
      min-width: 12em;
      border-radius: 0.25rem;
    }

    .focus {
      box-shadow: 0 0 0 2px var(--blue-200);
    }

    .heading-text {
      color: var(--heading-text-color);
      font-weight: 600;
      font-size: 1.125rem;
    }

    .body-text {
      color: var(--body-text-color);
    }

    .secondary-text {
      color: var(--secondary-text-color);
      font-size: 0.9rem;
    }

    .tertiary-text {
      color: var(--tertiary-text-color);
      font-size: 0.85rem;
    }

    .row .palettes {
      position: relative;
    }

    .row .palettes > .current {
      position: absolute;
      z-index: 100;
      width: 100%;
    }

    .compare:not(:checked) ~ .row .palettes > .current {
      display: none;
    }
  </style>
  <script type="module">
    import {BezierEasing} from './BezierEasing.js';
    import {normal as blendColors} from './node_modules/color-blend/dist/index.mjs';
    import {parseColor, getComputedColor, getContrast, hslToRgb, rgbToHsl} from './ColorUtil.js';

    function generatePalette(props) {
      const {
        name,
        values = [50, 100, 200, 300, 400, 500, 600, 700, 800, 900],
        hue = 0,
        saturation = 100,
        contrastMin = 0.4, // 0 == no contrast, 1 == max contrast
        contrastMax = 0.92,
        contrastSteepness = 0.2, // how quickly the contrast increases (ease-out vs ease-in). 0 == close to linear
        alphaMin = 0.1,
        alphaMax = 1,
        alphaSteepness = 0.3,
        dark = false
      } = props;

      let x1 = 1 - contrastSteepness,
          y1 = contrastSteepness,
          x2 = 1 - contrastSteepness,
          y2 = 1 - contrastSteepness;
      const contrastCurve = BezierEasing(x1, y1, x2, y2);

      x1 = alphaSteepness,
      y1 = alphaSteepness / 2,
      x2 = 0,
      y2 = 1 - alphaSteepness;
      const alphaCurve = BezierEasing(x1, y1, x2, y2);

      const colors = values.map((val, i) => {
        let sample = i / (values.length - 1);

        let contrast = contrastCurve(sample);
        contrast = contrastMin + (1 - contrastMin) * contrast * contrastMax;
        // if (dark) {
        //   contrast = (1 - contrastMin) + contrastMin * contrast * contrastMax;
        // }
        contrast = dark ? contrast : 1 - contrast;
        contrast = Math.round(contrast * 100);

        let alpha = alphaMin + (1 - alphaMin) * alphaCurve(sample) * alphaMax;
        alpha = Math.round((alpha + Number.EPSILON) * 100) / 100;

        return { h: hue, s: saturation, l: contrast, a: alpha, name: `${name}-${val}` };
      });

      return {name, colors, dark}
    }

    function addPaletteCustomProps(palette) {
      let props = palette.colors.map(({h, s, l, a, name}) => `--${name}: hsla(${h}, ${s}%, ${l}%, ${a});`).join('\n');

      const styleEl = document.createElement('style');
      styleEl.classList.add(palette.name);
      styleEl.classList.toggle('dark', palette.dark);
      document.head.appendChild(styleEl);
      styleEl.sheet.insertRule(`${palette.dark ? '.dark' : 'html'} { ${props} }`);
    }

    function renderPalette(palette) {
      return `
      <div class="palette ${palette.name}${palette.dark ? ' dark': ''}">
        ${palette.colors.map(({h, s, l, a, name}) => `
          <div class="swatch swatch-${name}">
            <span class="color" style="background-color: hsla(${h},${s}%,${l}%,${a});"></span>
          </div>`
        ).join('')}
      </div>
      `;
    }

    function appendPalette(paletteConf) {
      const palette = generatePalette(paletteConf);
      addPaletteCustomProps(palette);
      document.querySelector(`${paletteConf.dark ? '.dark' : '.light'} .palettes`).innerHTML += renderPalette(palette);
    }

    function calculateContrast(el) {
      const colorStack = [];
      do {
        let color = getComputedColor(el);
        if (el === document.documentElement && color.a === 0) {
          // Assuming the default white background (user-agent style sheet)
          color = {r:255,g:255,b:255,a:1};
        }
        colorStack.unshift(color);
      } while ((el = el.parentNode) !== document);

      const fg = colorStack.reduce((acc, cur, curIndex, array) => {
        return blendColors(acc, cur);
      });

      colorStack.pop();

      const bg = colorStack.reduce((acc, cur, curIndex, array) => {
        return blendColors(acc, cur);
      });

      const contrastBg = getContrast(bg, fg);
      const contrastWhite = getContrast({r:255,g:255,b:255,a:1}, fg);
      const contrastBlack = getContrast({r:0,g:0,b:0,a:1}, fg);
      const levelBg = contrastBg >= 7 ? 'aaa' : (contrastBg >= 4.5 ? 'aa' : undefined);
      const levelWhite = contrastWhite >= 7 ? 'aaa' : (contrastWhite >= 4.5 ? 'aa' : undefined);
      const levelBlack = contrastBlack >= 7 ? 'aaa' : (contrastBlack >= 4.5 ? 'aa' : undefined);

      return {
        bg: {value: contrastBg, level: levelBg},
        white: {value: contrastWhite, level: levelWhite},
        black: {value: contrastBlack, level: levelBlack}
      };
    }

    let ligthPalettes = document.querySelector('.light');
    let darkPalettes = ligthPalettes.cloneNode(true);
    darkPalettes.className = 'dark';
    ligthPalettes.parentNode.appendChild(darkPalettes);

    ligthPalettes = ligthPalettes.querySelector('.palettes');
    darkPalettes = darkPalettes.querySelector('.palettes');

    const gray = {
      name: 'gray',
      hue: 216,
      saturation: 12,
      contrastMax: 0.85,
      contrastSteepness: 0.25
    };
    appendPalette(gray);
    appendPalette({...gray, dark: true, contrastMax: 1});

    // Compute base colors from the gray palette
    const grayPalette = generatePalette(gray);
    const baseLight = rgbToHsl(
      blendColors(
        {r:255,g:255,b:255,a:1},
        hslToRgb(
          grayPalette.colors[0]
        )
      )
    );
    const baseDark = rgbToHsl(
      blendColors(
        {r:0,g:0,b:0,a:1},
        hslToRgb(
          grayPalette.colors[grayPalette.colors.length - 1]
        )
      )
    );

    baseLight.name = 'base-color';
    addPaletteCustomProps(
      {
        name: 'base',
        colors: [baseLight],
        dark: false
      }
    );

    baseDark.name = 'base-color';
    addPaletteCustomProps(
      {
        name: 'base',
        colors: [baseDark],
        dark: true
      }
    );

    const blue = {
      name: 'blue',
      hue: 216,
      saturation: 90,
      contrastMin: 0.06,
      contrastMax: 0.8,
      contrastSteepness: 0.6,
      alphaMin: 0.7
    };
    appendPalette(blue);
    appendPalette({
      ...blue,
      dark: true,
      contrastMin: 0.4,
      contrastMax: 0.9,
      contrastSteepness: 0.25,
      alphaMin: 0.1,
      alphaSteepness: 0.2
    });

    const red = {
      name: 'red',
      hue: 3,
      saturation: 100,
      contrastMin: 0.06,
      contrastMax: 0.85,
      contrastSteepness: 0.65,
      alphaMin: 0.7
    };
    appendPalette(red);
    appendPalette({...red, dark: true, contrastSteepness: 0.27});

    const green = {
      name: 'green',
      hue: 140,
      saturation: 90,
      contrastMin: 0.3,
      contrastMax: 1,
      contrastSteepness: 1,
      alphaMin: 0.5,
      alphaSteepness: 0.2
    };
    appendPalette(green);
    appendPalette({...green, dark: true, contrastSteepness: 0, saturation: 60});

    // const shadow = {
    //   name: 'shadow',
    //   values: [1,2,3],
    //   hue: 0,
    //   saturation: 0,
    //   contrastMin: 1,
    //   contrastMax: 1,
    //   contrastSteepness: 0,
    //   alphaMin: 0.1,
    //   alphaMax: 0.2,
    //   alphaSteepness: 0.5
    // };
    // appendPalette(shadow);
    // appendPalette({...shadow, dark: true});

    // Insert contrast values into all color swatches
    Array.from(document.querySelectorAll('.swatch .color')).forEach(el => {
      const contrast = calculateContrast(el);
      el.parentNode.innerHTML += `
        <span class="contrast bg" ${contrast.bg.level ? `level="${contrast.bg.level}"` : ''}>${contrast.bg.value.toFixed(2)}</span>
        <span class="contrast white" ${contrast.white.level ? `level="${contrast.white.level}"` : ''}>${contrast.white.value.toFixed(2)}</span>
        <span class="contrast black" ${contrast.black.level ? `level="${contrast.black.level}"` : ''}>${contrast.black.value.toFixed(2)}</span>
      `;
    })
  </script>
</head>

<body>

  <input type="checkbox" class="compare" id="compare"> <label for="compare">Compare to current</label>
  <div class="row">
    <div class="light">
      <section class="palettes">
        <div class="current">
          <section class="labels current">
            <div>5%</div>
            <div>10%</div>
            <div>20%</div>
            <div>30%</div>
            <div>40%</div>
            <div>50%</div>
            <div>60%</div>
            <div>70%</div>
            <div>80%</div>
            <div>90%</div>
            <div>100%</div>
          </section>
          <section class="palette current">
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-5pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-10pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-20pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-30pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-40pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-50pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-60pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-70pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-80pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast-90pct);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-contrast);"></span></div>
          </section>
          <!-- <section class="labels current">
            <div>10%</div>
            <div class="swatch"></div>
            <div>50%</div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div>100%</div>
            <div>Text</div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
          </section> -->
          <section class="palette current">
            <div class="swatch"><span class="color" style="background-color: var(--lumo-primary-color-10pct);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-primary-color-50pct);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-primary-color);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-primary-text-color);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
          </section>
          <section class="palette current">
            <div class="swatch"><span class="color" style="background-color: var(--lumo-error-color-10pct);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-error-color-50pct);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-error-color);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-error-text-color);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
          </section>
          <section class="palette current">
            <div class="swatch"><span class="color" style="background-color: var(--lumo-success-color-10pct);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-success-color-50pct);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-success-color);"></span></div>
            <div class="swatch"><span class="color" style="background-color: var(--lumo-success-text-color);"></span></div>
            <div class="swatch"></div>
            <div class="swatch"></div>
          </section>
        </div>

        <section class="labels">
          <div>50</div>
          <div>100</div>
          <div>200</div>
          <div>300</div>
          <div>400</div>
          <div>500</div>
          <div>600</div>
          <div>700</div>
          <div>800</div>
          <div>900</div>
        </section>
      </section>

      <section class="testing">
        <div class="surface one"></div>
        <div class="surface two"></div>

        <div class="heading-text">Heading text</div>
        <!-- <div class="body-text">Body text</div> -->
        <div class="secondary-text">Secondary text</div>
        <!-- <div class="tertiary-text">Tertiary text</div> -->

        <p class="body-text">Body text, lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore</p>
        <div class="link">Link text</div>
        <div class="button">Button</div>
        <div class="button primary">Button</div>
        <div class="text-input">Text input</div>
        <br>

        <div class="button focus">Button</div>
        <div class="button primary focus">Button</div>
        <div class="text-input focus">Text input</div>
      </section>
    </div>
  </div>



</body>

</html>
